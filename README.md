Secure Chat â€” INFOSEC Assignment 2

Fall 2025 â€” Secure Communication System with PKI, DH, AES-128, RSA Signatures, MySQL & Non-Repudiation

This repository contains the complete implementation of the Secure Chat assignment for the INFOSEC course.
It includes a custom Public Key Infrastructure (PKI), authenticated clientâ€“server communication, DH-based ephemeral key exchange, encrypted & signed chat messages, tamper/replay protection, user registration/login with database, transcripts, signed session receipts, and attack/defense testing (tamper, replay, invalid-cert).

ğŸ“ Project Structure
secure-chat/
â”œâ”€â”€ README.md
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ .gitignore
â”œâ”€â”€ .env.example
â”‚
â”œâ”€â”€ certs/                 # (ignored) Contains CA, server, and client certs/keys
â”‚
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ gen_ca.py          # Generate CA keypair + self-signed cert
â”‚   â”œâ”€â”€ gen_cert.py        # Generate leaf certs (server/client) signed by CA
â”‚   â”œâ”€â”€ tamper_resend.py   # Tamper/replay attack script
â”‚   â”œâ”€â”€ verify_session.py  # Verify transcript integrity + receipt signatures
â”‚   â”œâ”€â”€ verify_all.sh      # End-to-end receipt/transcript verification
â”‚   â””â”€â”€ package_submission.sh
â”‚
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ crypto_utils.py    # DH, AES-128-CBC, RSA sign/verify helpers
â”‚   â”œâ”€â”€ cert_utils.py      # Certificate parsing & fingerprint utilities
â”‚   â””â”€â”€ transcript.py      # Append-only transcripts + signed receipts
â”‚
â”œâ”€â”€ db/
â”‚   â”œâ”€â”€ db.py              # MySQL interface (registration/login)
â”‚   â””â”€â”€ secure_chat_schema.sql
â”‚
â”œâ”€â”€ auth/
â”‚   â”œâ”€â”€ auth_server.py     # Handles registration + login over DH-protected channel
â”‚   â””â”€â”€ auth_client.py
â”‚
â”œâ”€â”€ chat/
â”‚   â”œâ”€â”€ chat_server.py     # Main secure chat server
â”‚   â””â”€â”€ chat_client.py     # Chat client (encrypted + signed messages)
â”‚
â”œâ”€â”€ transcripts/           # Autogenerated logs + signed receipts (per session)
â””â”€â”€ docs/
    â””â”€â”€ TestReport.docx    # Final report with screenshots + PCAP evidence

ğŸ§° 1. Requirements
Software

Python 3.10+

OpenSSL (CLI tools)

MySQL Server 8.x

Wireshark (for PCAP evidence)

Git + GitHub repository

Python dependencies

Installed via:

pip install -r requirements.txt

Environment Variables

Create .env:

cp .env.example .env


Configure MySQL credentials + host/port + cert locations.

ğŸš€ 2. Quick Start
Step 1 â€” Create and activate virtual environment
python3 -m venv venv
source venv/bin/activate     # Windows: venv\Scripts\activate
pip install -r requirements.txt

Step 2 â€” Generate CA + certificates

From project root:

python scripts/gen_ca.py
python scripts/gen_cert.py server
python scripts/gen_cert.py client1


Certs will appear inside certs/ (which is .gitignored).

Step 3 â€” Start MySQL and initialize DB schema
mysql -u root -p < db/secure_chat_schema.sql

Step 4 â€” Run authentication server + client (registration/login)

Terminal A:

python auth/auth_server.py


Terminal B:

python auth/auth_client.py

Step 5 â€” Run chat server + client

Terminal A:

python chat/chat_server.py


Terminal B:

python chat/chat_client.py


Messages are:

Encrypted using AES-128-CBC

Signed using RSA-SHA256

Protected with sequence numbers

Logged to a tamper-evident transcript

Finalized with signed session receipts

ğŸ” 3. Security Architecture Overview
PKI (Phase B)

Custom Certificate Authority generated locally.

Server/client certificates signed by CA using RSA-2048.

Verified using issuer fingerprint + validity window.

Authentication (Phase C)

Registration & login performed inside a DH-protected channel.

Credentials NEVER sent plaintext (verified via PCAP).

Session Key Exchange (Phase D)

Client â†’ Server: ephemeral DH public value + certificate + signature.

Server â†’ Client: DH reply + certificate + signature.

Both derive same shared secret â†’ AES-128 key.

Secure Messaging (Phase E)

Each message includes:

{
  "seqno": n,
  "iv": "<16 bytes b64>",
  "ct": "<ciphertext b64>",
  "sig": "<RSA signature b64>",
  "ts_ms": 1234567890123
}


Protection:

AES-128-CBC encryption

RSA-SHA256 digital signatures

Replay detection (sequence numbers)

Tamper detection (signature mismatch)

Server Logic (Phase F)

Maintains expected seqno

Validates signatures & decrypts

Logs plaintext in transcript

Sends ACK or error codes

Receipts & Non-Repudiation (Phase I)

At session close:

Both parties compute sha256(transcript)

Both sign the hex digest

Both exchange signed receipts

Both store receipts + transcripts for dispute resolution

ğŸ§ª 4. Testing & Evidence Collection
PCAP capture

Registration:

sudo tcpdump -i lo port 9001 -w evidence_auth_reg.pcap


Chat:

sudo tcpdump -i lo port 9010 -w evidence_chat_session.pcap


Wireshark filter examples:

tcp.port == 9010
frame contains "ct"
frame contains "payload_b64"

Tamper & Replay Attacks

Replay:

python scripts/tamper_resend.py replay saved_msg.json


Tamper ciphertext:

python scripts/tamper_resend.py tamper saved_msg.json ct 20


Tamper signature:

python scripts/tamper_resend.py tamper saved_msg.json sig 5


Expected server responses:

DECRYPT_FAIL

SIG_FAIL

REPLAY_OR_OUT_OF_ORDER

Include these logs in TestReport.docx.

Receipt Verification

Using Python:

python scripts/verify_session.py <session_id> certs/server.cert.pem transcripts/<session_id>.server.receipt.json


Using OpenSSL:

openssl x509 -in certs/server.cert.pem -pubkey -noout > server.pub.pem
echo -n "<hex_digest>" > digest.txt
base64 -d < sig_b64 > sig.bin
openssl dgst -sha256 -verify server.pub.pem -signature sig.bin digest.txt


Expected output:
Verified OK

ğŸ“„ 5. Test Report (docs/TestReport.docx)

The TestReport contains:

PCAP screenshots

Console logs

Transcript snippet

Signed receipts

Tamper & replay evidence

Receipt verification steps

SQL schema

Summary and conclusions

A template is included in the repository.

ğŸ“¦ 6. Submission Packaging

Generate submission zip:

./scripts/package_submission.sh


It will create:

submission.zip
 â”œâ”€â”€ code/
 â”œâ”€â”€ transcripts/
 â”œâ”€â”€ pcaps/
 â”œâ”€â”€ sql/
 â””â”€â”€ docs/


certs/ and .env are excluded as required.

âœ”ï¸ 7. Assignment Requirements Checklist
Requirement	Status
PKI (CA + certs)	âœ”ï¸
Hello exchange with cert verification	âœ”ï¸
DH session key establishment	âœ”ï¸
AES-128 encrypted messaging	âœ”ï¸
RSA signatures on messages	âœ”ï¸
Replay protection	âœ”ï¸
Tamper detection	âœ”ï¸
Registration & login DB	âœ”ï¸
Transcripts	âœ”ï¸
Signed receipts (non-repudiation)	âœ”ï¸
PCAP evidence	âœ”ï¸
TestReport.docx	âœ”ï¸
Packaging script	âœ”ï¸
â¤ï¸ Credits

Developed by Kainat Khalid for INFOSEC Assignment 2 (Fall 2025).
